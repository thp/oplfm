#
# oplfm: OPL2/OPL3 Instrument Toolkit for C and Python
# Copyright (C) 2016, 2017 Thomas Perl <m@thp.io>
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 2.1 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
#

import oplfm
import time


sheets = [
"""
aaa.a...........aaa.a...........aaa.a...........aa.abb.baa.abb.b
................................................................
aaaaaaaaaaaaa...eeeeeeeeeeee....dddddddddddd....aaaaaaaaaaaa....
................................................................
""",
"""
aaa.a...........aaa.a...........aaa.a...........aaa.a..bbb.b....
................................................................
aaaaaaaaaaaaa...eeeeeeeeeeee....dddddddddddd....aaaaaaaaaaaa....
.........a.a............a.a.............a.a.............a.a.....
""",
"""
aaa.a.aaa.a.....aaa.a...........aaa.a.bbb.b.....aaa.a..bbb.b....
................................................................
aaaaaaaaaaaaa...aaaaaaaaaaaa....eeeeeeeeeeee....dddddddddddd....
aaaa............a.a.............aaaa............a.a.............
""",
"""
aaa.a.ccc.c.....aaa.a...........bbb.b.ddd.d.d...aaa.a..ccc.c.c..
................................................................
aaaaaaaaaaaaa...aaaaaaaaaaaa....eeeeeeeeeeee....dddddddddddd....
aaaa............aaaa............aaaa............a.a.a.a.a.a.a.a.
""",
"""
aa..bb..cc..dd..aa..dd..cc..bb..aa......aabb....bb.....defedba..
................................................................
aaaaa...........aaaaa...........aaaaa...........aaaaa...........
a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.a.
""",
"""
defedba.defedba.defedba.defedba.................................
................................................................
bbbbb...........bbbbb...........bbbbb...........aaaaa...........
a.a.a.a.a.a.a.a.................................aaaaa.....aaaaa.
""",
"""
defedba.defedba.defedba.defedba.................................
................................................................
aaaaa...bbbbb...ccccc...........ccccc...bbbbb...aaaaa...........
aaaa............aaaa............aaaa............a.a.a.a.a.a.a.a.
""",
"""
................................................................
................................................................
................................................................
................................................................
""",
"""
a...a...........a...a...........a...a...........a...b...b...a...
................................................................
................................................................
................................................................
""",
"""
a...a...........a...a...........a...a...........a...b...b...a...
................................................................
....................................e.e.e...........f.g.h.......
....a.a.a.......................................................
""",
"""
a...a...b.......a...a...........a...a...b.......a...b...b...a...
................................................................
................................................................
....a.a.a...........b.b.b...........c...c...........d.d.d.d.d...
""",
"""
................................................................
a...a...b.......a...a...........a...a...b.......a...b...b...a...
................................................................
....a.a.a...........b.b.b...........c...c...........d.d.d.d.d...
""",
"""
................................................................
....b.e...e.e...b.bbb........bb..aa......abc...def...fed...cba..
................................................................
b.e...e.e...b.bbb........bb..aa......abc...def...fed...cba......
""",
"""
aa......aa......bb..............aa......aa......bb......aa......
....dd......dd......................dd..............dd..........
....................e.e.e.e.e.......................e.f.g.f.g...
e.......e.......e.......e.......e.......e...e...e.......e.......
""",
"""
....b.e...e.e...b.bbb........bb..aa......abc...def...fed...cba..
................................................................
a.a.............................................................
........................................................a.a.a...
""",
]

instruments = [
    oplfm.Instrument('MOOGSYNT'),
    oplfm.Instrument('PIANO1'),
    oplfm.Instrument('BASS2'),
    oplfm.Instrument('NOISE1'),
]

last_notes = ['.'] * len(instruments)
base = [60, 50, 40, 60]

speed = 0.9

while True:
    for sheet in sheets:
        print('='*20)
        for iit, iteration in enumerate(zip(*sheet.strip().splitlines())):
            print(''.join(c*4 for c in iteration))
            for idx, (note, instrument) in enumerate(zip(iteration, instruments)):
                if last_notes[idx] == note:
                    continue

                if last_notes[idx] != '.':
                    n = base[idx] + ord(last_notes[idx]) - ord('a')
                    instrument.note(n, 0)

                if note != '.':
                    n = base[idx] + ord(note) - ord('a')
                    instrument.note(n, 127)

                last_notes[idx] = note

            time.sleep(.06*speed)
